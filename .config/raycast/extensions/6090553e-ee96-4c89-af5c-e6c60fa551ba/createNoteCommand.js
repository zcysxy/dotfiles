var B=Object.create;var y=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var w=t=>y(t,"__esModule",{value:!0});var q=(t,e)=>{for(var r in e)y(t,r,{get:e[r],enumerable:!0})},b=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of K(e))!z.call(t,l)&&(r||l!=="default")&&y(t,l,{get:()=>e[l],enumerable:!(a=$(e,l))||a.enumerable});return t},x=(t,e)=>b(w(y(t!=null?B(G(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),H=(t=>(e,r)=>t&&t.get(e)||(r=b(w({}),e,1),t&&t.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var Z={};q(Z,{default:()=>j});var _=require("@raycast/api");var n=require("@raycast/api");var i=require("@raycast/api"),h=x(require("path")),S=x(require("fs"));var p=require("@raycast/api");var F=x(require("path")),E=require("fs/promises"),k=require("os"),f=require("react");var d=require("@raycast/api");function C(t){let e=t.split(F.default.sep).filter(r=>{if(r!="")return r}).pop();return e||"Default Vault Name (check your path preferences)"}function A(){return(0,p.getPreferenceValues)().vaultPath.split(",").filter(r=>r.trim()!=="").map(r=>({name:C(r.trim()),key:r.trim(),path:r.trim()}))}async function U(){let t=F.default.resolve(`${(0,k.homedir)()}/Library/Application Support/obsidian/obsidian.json`);try{let e=JSON.parse(await(0,E.readFile)(t,"utf8"));return Object.values(e.vaults).map(({path:r})=>({name:C(r),key:r,path:r}))}catch{return[]}}function O(){let t=(0,f.useMemo)(()=>(0,p.getPreferenceValues)(),[]),[e,r]=(0,f.useState)(t.vaultPath?{ready:!0,vaults:A()}:{ready:!1,vaults:[]});return(0,f.useEffect)(()=>{e.ready||U().then(a=>{r({vaults:a,ready:!0})}).catch(()=>r({vaults:A(),ready:!0}))},[]),e}async function W(){let t=await p.Clipboard.readText();return t||""}var Q={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"},X={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"};async function T(t){let e=new Date,r=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0"),l=e.getSeconds().toString().padStart(2,"0"),g=Date.now().toString();t=t.replaceAll("{time}",e.toLocaleTimeString()),t=t.replaceAll("{date}",e.toLocaleDateString()),t=t.replaceAll("{year}",e.getFullYear().toString()),t=t.replaceAll("{month}",X[e.getMonth()]),t=t.replaceAll("{day}",Q[e.getDay()]),t=t.replaceAll("{hour}",r),t=t.replaceAll("{minute}",a),t=t.replaceAll("{second}",l),t=t.replaceAll("{millisecond}",e.getMilliseconds().toString()),t=t.replaceAll("{timestamp}",g),t=t.replaceAll("{zettelkastenID}",g);let N=await W();return t=t.replaceAll("{clipboard}",N),t}var L=class{constructor(e,r,a){this.saved=!1;this.vaultPath=r.path,this.noteProps=e,this.pref=a}async createNote(){this.noteProps.name==""&&(this.noteProps.name=this.pref.prefNoteName);let e=this.addYAMLFrontmatter("");e=await T(e);let r=await T(this.noteProps.name);if(this.saveNote(e,r),this.pref.openOnCreate){let a="obsidian://open?path="+encodeURIComponent(h.default.join(this.vaultPath,this.noteProps.path,r+".md"));(0,i.open)(a)}return this.saved}addYAMLFrontmatter(e){if(this.noteProps.tags.length>0){e=`---
tags: [`;for(let r=0;r<this.noteProps.tags.length-1;r++)e+='"'+this.noteProps.tags[r]+'",';e+='"'+this.noteProps.tags.pop()+`"]
---
`}return e+=this.noteProps.content,e}async saveNote(e,r){let a=h.default.join(this.vaultPath,this.noteProps.path);if(S.default.existsSync(h.default.join(a,r+".md"))){let l={title:"Override note",message:'Are you sure you want to override the note: "'+r+'"?',icon:i.Icon.ExclamationMark};await(0,i.confirmAlert)(l)&&this.writeToFile(a,r,e)}else this.writeToFile(a,r,e)}writeToFile(e,r,a){try{try{S.default.mkdirSync(e,{recursive:!0})}catch{(0,i.showToast)({title:"Couldn't create directories for the given path:",message:e,style:i.Toast.Style.Failure});return}try{S.default.writeFileSync(h.default.join(e,r+".md"),a)}catch{(0,i.showToast)({title:"Couldn't write to file:",message:e+"/"+r+".md",style:i.Toast.Style.Failure});return}(0,i.showToast)({title:"Note created",style:i.Toast.Style.Success}),this.saved=!0}catch{(0,i.showToast)({title:"Something went wrong",message:" Maybe your vault, path or filename is not valid",style:i.Toast.Style.Failure})}}},M=L;function v(t){let e=t.vault,r=(0,n.getPreferenceValues)(),{pop:a}=(0,n.useNavigation)();function l(){let o=r.folderActions;return o?o.split(",").filter(u=>!!u).map(u=>u.trim()):[]}function g(){let o=r.tags,s=r.prefTag;if(!o)return s?[{name:s,key:s}]:[];let u=o.split(",").map(m=>({name:m.trim(),key:m.trim()})).filter(m=>!!m);return s&&u.push({name:s,key:s}),u}function N(){let o=r.prefTag;return o?[o]:[]}function R(){let o=r.prefPath;return o||""}async function V(o,s=void 0){s!==void 0&&(o.path=s),await new M(o,e,r).createNote()&&a()}return _jsx(n.Form,{navigationTitle:"Create Note",actions:_jsx(n.ActionPanel,null,_jsx(n.Action.SubmitForm,{title:"Create",onSubmit:V}),l()?.map((o,s)=>_jsx(n.Action.SubmitForm,{title:"Create in "+o,onSubmit:u=>V(u,o),key:s,shortcut:{modifiers:["shift","cmd"],key:s.toString()}})))},_jsx(n.Form.TextField,{title:"Name",id:"name",placeholder:"Name of note"}),_jsx(n.Form.TextField,{title:"Path",id:"path",defaultValue:R(),placeholder:"path/to/note (optional)"}),_jsx(n.Form.TagPicker,{id:"tags",title:"Tags",defaultValue:N()},g()?.map(o=>_jsx(n.Form.TagPicker.Item,{value:o.name.toLowerCase(),title:o.name,key:o.key}))),_jsx(n.Form.TextArea,{title:"Content:",id:"content",placeholder:"Text"}))}var c=require("@raycast/api");function D(t){let e=t.vaults;return _jsx(c.List,null,e?.map(r=>_jsx(c.List.Item,{title:r.name,key:r.key,actions:_jsx(c.ActionPanel,null,_jsx(c.Action.Push,{title:"Select Vault",target:t.target(r)}))})))}var I=require("@raycast/api");function Y(){return _jsx(I.Detail,{markdown:`# No vaults found

 Please use Obsidian to create a vault, or set a vault path in the extension's preferences before using this command.`})}var P=require("@raycast/api");function J(){(0,P.showToast)({title:"Path Error",message:"Something went wrong with your vault path. There are no paths to select from.",style:P.Toast.Style.Failure})}function j(){let{vaults:t,ready:e}=O();if(e){if(t.length===0)return _jsx(Y,null);if(t.length>1)return _jsx(D,{vaults:t,target:r=>_jsx(v,{vault:r})});if(t.length==1)return _jsx(v,{vault:t[0]});J()}else return _jsx(_.List,{isLoading:!0})}module.exports=H(Z);0&&(module.exports={});
