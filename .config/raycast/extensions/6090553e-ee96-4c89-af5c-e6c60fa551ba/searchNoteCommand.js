var xt=Object.create;var V=Object.defineProperty;var bt=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var At=Object.getPrototypeOf,vt=Object.prototype.hasOwnProperty;var $=t=>V(t,"__esModule",{value:!0});var Ct=(t,e)=>{for(var o in e)V(t,o,{get:e[o],enumerable:!0})},U=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of kt(e))!vt.call(t,i)&&(o||i!=="default")&&V(t,i,{get:()=>e[i],enumerable:!(n=bt(e,i))||n.enumerable});return t},h=(t,e)=>U($(V(t!=null?xt(At(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),Ft=(t=>(e,o)=>t&&t.get(e)||(o=U($({}),e,1),t&&t.set(e,o),o))(typeof WeakMap!="undefined"?new WeakMap:0);var Rt={};Ct(Rt,{default:()=>Pt});var St=require("@raycast/api");var p=require("@raycast/api"),T=h(require("fs")),R=h(require("path")),Q=require("fs/promises"),G=require("os"),A=require("react");var l=require("@raycast/api"),P=h(require("fs"));function O(t){P.default.existsSync(l.environment.supportPath+"/data.json")||P.default.writeFileSync(l.environment.supportPath+"/data.json","[]");let e=P.default.readFileSync(l.environment.supportPath+"/data.json","utf8"),o=JSON.parse(e),n=o.filter(i=>i.vaultPath==t.path);if(n.length==0){let i={vaultPath:t.path,pinnedNotes:[]};return o.push(i),P.default.writeFileSync(l.environment.supportPath+"/data.json",JSON.stringify(o)),{vault:i,pinnedNotes:i.pinnedNotes,data:o}}else return{vault:n[0],pinnedNotes:n[0].pinnedNotes,data:o}}function w(t,e){let o=O(e),n=o.pinnedNotes.filter(a=>a.path!==t.path);o.vault.pinnedNotes=n;let i=o.data.findIndex(a=>a.vaultPath==e.path);return o.data[i]=o.vault,P.default.writeFileSync(l.environment.supportPath+"/data.json",JSON.stringify(o.data)),(0,l.showToast)({title:"Note Unpinned",message:"'"+t.title+"' unpinned successfully.",style:l.Toast.Style.Success}),n}function y(t,e){return O(e).pinnedNotes.filter(n=>n.path==t.path).length!==0}function z(t,e){let o=O(e);if(y(t,e)){(0,l.showToast)({title:"Already Pinned",message:"'"+t.title+"' is already pinned.",style:l.Toast.Style.Failure});return}o.vault.pinnedNotes.push(t);let n=o.data.findIndex(i=>i.vaultPath==e.path);o.data[n]=o.vault,P.default.writeFileSync(l.environment.supportPath+"/data.json",JSON.stringify(o.data)),(0,l.showToast)({title:"Note Pinned",message:"'"+t.title+"' pinned successfully.",style:l.Toast.Style.Success})}function Vt(t){let e=(0,p.getPreferenceValues)();if(e.removeYAML){let o=t.match(/---(.|\n)*?---/gm);o&&(t=t.replace(o[0],""))}if(e.removeLatex){let o=t.matchAll(/\$\$(.|\n)*?\$\$/gm);for(let i of o)t=t.replace(i[0],"");let n=t.matchAll(/\$(.|\n)*?\$/gm);for(let i of n)t=t.replace(i[0],"")}return e.removeLinks&&(t=t.replaceAll("![[",""),t=t.replaceAll("[[",""),t=t.replaceAll("]]","")),t}function S(t,e=!0){let o="";try{o=T.default.readFileSync(t,"utf8")}catch{o="Couldn't read file. Did you move, delete or rename the file?"}return e&&(o=Vt(o)),o}function K(t){let e=t.split(R.default.sep).filter(o=>{if(o!="")return o}).pop();return e||"Default Vault Name (check your path preferences)"}function H(){return(0,p.getPreferenceValues)().vaultPath.split(",").filter(o=>o.trim()!=="").map(o=>({name:K(o.trim()),key:o.trim(),path:o.trim()}))}async function wt(){let t=R.default.resolve(`${(0,G.homedir)()}/Library/Application Support/obsidian/obsidian.json`);try{let e=JSON.parse(await(0,Q.readFile)(t,"utf8"));return Object.values(e.vaults).map(({path:o})=>({name:K(o),key:o,path:o}))}catch{return[]}}function W(){let t=(0,A.useMemo)(()=>(0,p.getPreferenceValues)(),[]),[e,o]=(0,A.useState)(t.vaultPath?{ready:!0,vaults:H()}:{ready:!1,vaults:[]});return(0,A.useEffect)(()=>{e.ready||wt().then(n=>{o({vaults:n,ready:!0})}).catch(()=>o({vaults:H(),ready:!0}))},[]),e}async function X(t,e){let o={title:"Delete Note",message:'Are you sure you want to delete the note: "'+t.title+'"?',icon:p.Icon.ExclamationMark};if(await(0,p.confirmAlert)(o))try{return T.default.unlinkSync(t.path),y(t,e)&&w(t,e),(0,p.showToast)({title:"Deleted Note",style:p.Toast.Style.Success}),!0}catch{return!1}else return!1}function q(t,e,o){return e.length===0?t:t.filter(n=>o?n.title.toLowerCase().includes(e.toLowerCase())||n.content.toLowerCase().includes(e.toLowerCase()):n.title.toLowerCase().includes(e.toLowerCase())).sort((n,i)=>{let a=n.title,s=i.title;return a>s?1:a<s?-1:0})}function _(t){return t.split(" ").length}function Z(t){return Math.ceil(_(t)/200)}function tt(t){let{birthtime:e}=T.default.statSync(t.path);return e}function et(t){let{size:e}=T.default.statSync(t.path);return e/1024}function ot(t,e){return t.length>e?"..."+t.slice(t.length-e).slice(1):t.slice(1)}async function Et(){let t=await p.Clipboard.readText();return t||""}var Dt={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"},Lt={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"};async function E(t){let e=new Date,o=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),i=e.getSeconds().toString().padStart(2,"0"),a=Date.now().toString();t=t.replaceAll("{time}",e.toLocaleTimeString()),t=t.replaceAll("{date}",e.toLocaleDateString()),t=t.replaceAll("{year}",e.getFullYear().toString()),t=t.replaceAll("{month}",Lt[e.getMonth()]),t=t.replaceAll("{day}",Dt[e.getDay()]),t=t.replaceAll("{hour}",o),t=t.replaceAll("{minute}",n),t=t.replaceAll("{second}",i),t=t.replaceAll("{millisecond}",e.getMilliseconds().toString()),t=t.replaceAll("{timestamp}",a),t=t.replaceAll("{zettelkastenID}",a);let s=await Et();return t=t.replaceAll("{clipboard}",s),t}var F=require("@raycast/api"),b=require("react"),ft=h(require("fs"));var nt=require("@raycast/api"),J=h(require("fs")),it=h(require("path"));var at=class{constructor(e){this.vaultPath=e.path}loadNotes(){let e=[],o=this.getFiles(),n=0;for(let i of o){let s=i.split("/").pop(),g="default";s&&(g=s.split(".md")[0]);let m={title:g,key:++n,path:i,content:S(i)};e.push(m)}return e}getFiles(){let e=this.prefExcludedFolders();return this.getFilesHelp(this.vaultPath,e,[])}getFilesHelp(e,o,n){let i=J.default.readdirSync(e);n=n||[];for(let a of i)J.default.statSync(e+"/"+a).isDirectory()&&!a.includes(".obsidian")?n=this.getFilesHelp(e+"/"+a,o,n):a.endsWith(".md")&&a!==".md"&&!e.includes(".obsidian")&&this.isValidFile(e,o)&&n.push(it.default.join(e,"/",a));return n}isValidFile(e,o){for(let n of o)if(e.includes(n))return!1;return!0}prefExcludedFolders(){let o=(0,nt.getPreferenceValues)().excludedFolders;if(o){let n=o.split(",");for(let i=0;i<n.length;i++)n[i]=n[i].trim();return n}else return[]}},rt=at;var u=require("@raycast/api"),C=h(require("react"));var r=require("@raycast/api"),dt=h(require("fs")),x=h(require("react"));var d=require("@raycast/api"),st=h(require("fs"));function lt(t){let e=t.note,{pop:o}=(0,d.useNavigation)();async function n(i){let a=await E(i.content);st.default.appendFileSync(e.path,`
`+a),(0,d.showToast)({title:"Added text to note",style:d.Toast.Style.Success}),o(),t.actionCallback(3)}return _jsx(d.Form,{navigationTitle:"Add text to: "+e.title,actions:_jsx(d.ActionPanel,null,_jsx(d.Action.SubmitForm,{title:"Submit",onSubmit:n}))},_jsx(d.Form.TextArea,{title:`Add text to:
`+e.title,id:"content",placeholder:"Text"}))}var c=require("@raycast/api"),ct=h(require("fs"));function ut(t){let e=t.note,{pop:o}=(0,c.useNavigation)();async function n(i){let a=i.content;a=await E(a);let s={title:"Override note",message:'Are you sure you want to override the note: "'+e.title+'"?',icon:c.Icon.ExclamationMark};await(0,c.confirmAlert)(s)&&(ct.default.writeFileSync(e.path,a),(0,c.showToast)({title:"Edited note",style:c.Toast.Style.Success}),t.actionCallback(1),o())}return _jsx(c.Form,{navigationTitle:"Edit: "+e.title,actions:_jsx(c.ActionPanel,null,_jsx(c.Action.SubmitForm,{title:"Submit",onSubmit:n}))},_jsx(c.Form.TextArea,{title:`Edit:
`+e.title,id:"content",placeholder:"Text",defaultValue:S(e.path,!1)}))}var v=require("@raycast/api"),Y=require("react");function pt(t){let e=t.note,o=t.vault,{pop:n}=(0,v.useNavigation)(),[i,a]=(0,Y.useState)(y(e,o)),[s,g]=(0,Y.useState)(e.content);function m(){let N=S(e.path);e.content=N,g(N)}function f(N,j=void 0){switch(t.actionCallback(N),+N){case 0:a(!i);break;case 2:n();break;case 1:m();break;case 3:m()}}return _jsx(v.Detail,{navigationTitle:i?"\u2B50 "+e.title:e.title,markdown:s,actions:_jsx(v.ActionPanel,null,_jsx(I,{note:e,vault:o,actionCallback:f}),_jsx(L,{note:e,vault:o,actionCallback:f}))})}async function It(t){let o=(0,r.getPreferenceValues)().appendPrefix;o===void 0&&(o="");try{let n=await(0,r.getSelectedText)();n.trim()==""?(0,r.showToast)({title:"No text selected",message:"Make sure to select some text.",style:r.Toast.Style.Failure}):(dt.default.appendFileSync(t.path,`
`+o+n),(0,r.showToast)({title:"Added selected text to note",style:r.Toast.Style.Success}))}catch{(0,r.showToast)({title:"Couldn't copy selected text",message:"Maybe you didn't select anything.",style:r.Toast.Style.Failure})}}function L(t){let e=t.note,o=t.vault,n=encodeURIComponent(e.path),i=t.actionCallback,[a,s]=(0,x.useState)(y(e,o));return _jsx(x.default.Fragment,null,_jsx(r.Action.ShowInFinder,{title:"Show in Finder",icon:r.Icon.Finder,path:e.path,shortcut:{modifiers:["opt"],key:"enter"}}),_jsx(r.Action.Push,{title:"Edit Note",target:_jsx(ut,{note:e,actionCallback:i}),shortcut:{modifiers:["opt"],key:"e"},icon:r.Icon.Pencil}),_jsx(r.Action.Push,{title:"Append to Note",target:_jsx(lt,{note:e,actionCallback:i}),shortcut:{modifiers:["opt"],key:"a"},icon:r.Icon.Pencil}),_jsx(r.Action,{title:"Append Selected Text to Note",shortcut:{modifiers:["opt"],key:"s"},onAction:()=>{It(e)},icon:r.Icon.Pencil}),_jsx(r.Action.CopyToClipboard,{title:"Copy Note Content",content:e.content,shortcut:{modifiers:["opt"],key:"c"}}),_jsx(r.Action.Paste,{title:"Paste Note Content",content:e.content,shortcut:{modifiers:["opt"],key:"v"}}),_jsx(r.Action.CopyToClipboard,{title:"Copy Markdown Link",icon:r.Icon.Link,content:`[${e.title}](obsidian://open?path=${n})`,shortcut:{modifiers:["opt"],key:"l"}}),_jsx(r.Action.CopyToClipboard,{title:"Copy Obsidian URI",icon:r.Icon.Link,content:`obsidian://open?path=${n}`,shortcut:{modifiers:["opt"],key:"u"}}),_jsx(r.Action,{title:a?"Unpin Note":"Pin Note",shortcut:{modifiers:["opt"],key:"p"},onAction:()=>{a?(w(e,o),s(!a),i(0)):(z(e,o),s(!a),i(0))},icon:a?r.Icon.XmarkCircle:r.Icon.Pin}),_jsx(r.Action,{title:"Delete Note",shortcut:{modifiers:["opt"],key:"d"},onAction:()=>{X(e,o).then(m=>{m&&i(2)})},icon:{source:r.Icon.Trash,tintColor:r.Color.Red}}))}function I(t){let e=t.note,o=t.vault,i=(0,r.getPreferenceValues)().primaryAction,a=_jsx(r.Action.Push,{title:"Quick Look",target:_jsx(pt,{note:e,vault:o,actionCallback:t.actionCallback}),icon:r.Icon.Eye}),s=_jsx(r.Action.Open,{title:"Open in Obsidian",target:"obsidian://open?path="+encodeURIComponent(e.path),icon:r.Icon.TextDocument});return i=="quicklook"?_jsx(x.default.Fragment,null,a,s):i=="obsidian"?_jsx(x.default.Fragment,null,s,a):_jsx(x.default.Fragment,null,a,s)}function Mt(t){let e=t.note,o=t.vault,[n,i]=(0,C.useState)(e.content),[a,s]=(0,C.useState)(y(e,o));function g(){let f=S(e.path);e.content=f,i(f)}function m(f){switch(+f){case 0:s(!a);break;case 2:t.onDelete(e);break;case 1:g();break;case 3:g()}}return _jsx(u.List.Item,{title:e.title,accessories:[{text:a?"\u2B50\uFE0F":""}],detail:_jsx(u.List.Item.Detail,{markdown:n,metadata:t.pref.showMetadata?_jsx(u.List.Item.Detail.Metadata,null,_jsx(u.List.Item.Detail.Metadata.Label,{title:"Character Count",text:n.length.toString()}),_jsx(u.List.Item.Detail.Metadata.Label,{title:"Word Count",text:_(n).toString()}),_jsx(u.List.Item.Detail.Metadata.Label,{title:"Reading Time",text:Z(n).toString()+" min read"}),_jsx(u.List.Item.Detail.Metadata.Separator,null),_jsx(u.List.Item.Detail.Metadata.Label,{title:"Creation Date",text:tt(e).toLocaleDateString()}),_jsx(u.List.Item.Detail.Metadata.Label,{title:"File Size",text:et(e).toFixed(2)+" KB"}),_jsx(u.List.Item.Detail.Metadata.Label,{title:"Note Path",text:ot(e.path.split(o.path)[1],55)})):_jsx(C.default.Fragment,null)}),actions:_jsx(u.ActionPanel,null,_jsx(C.default.Fragment,null,_jsx(I,{note:e,vault:o,actionCallback:m}),_jsx(L,{note:e,vault:o,actionCallback:m}),t.action&&t.action(e)))})}function mt(t){let e=t.notes,o=t.vault,n=(0,u.getPreferenceValues)(),i=e===void 0;return e!==void 0&&(i=e.length==0),t.isLoading!==void 0&&(i=t.isLoading),_jsx(u.List,{isLoading:i,isShowingDetail:n.showDetail,onSearchTextChange:t.onSearchChange},e?.map(a=>_jsx(Mt,{note:a,vault:o,key:a.key,pref:n,onDelete:t.onDelete,action:t.action})))}function B(t){let e=(0,F.getPreferenceValues)(),o=t.vault,[n,i]=(0,b.useState)([]),[a,s]=(0,b.useState)(""),g=(0,b.useMemo)(()=>q(n,a,e.searchContent),[n,a]);function m(f){i(n.filter(N=>N.path!==f.path))}return(0,b.useEffect)(()=>{async function f(){try{await ft.default.promises.access(o.path+"/.");let j=new rt(o).loadNotes();i(j)}catch{(0,F.showToast)({title:"The path set in preferences doesn't exist",message:"Please set a valid path in preferences",style:F.Toast.Style.Failure})}}f()},[]),_jsx(mt,{notes:g.slice(0,1e3),vault:o,onSearchChange:s,onDelete:m})}var k=require("@raycast/api");function ht(t){let e=t.vaults;return _jsx(k.List,null,e?.map(o=>_jsx(k.List.Item,{title:o.name,key:o.key,actions:_jsx(k.ActionPanel,null,_jsx(k.Action.Push,{title:"Select Vault",target:t.target(o)}))})))}var gt=require("@raycast/api");function Nt(){return _jsx(gt.Detail,{markdown:`# No vaults found

 Please use Obsidian to create a vault, or set a vault path in the extension's preferences before using this command.`})}var M=require("@raycast/api");function yt(){(0,M.showToast)({title:"Path Error",message:"Something went wrong with your vault path. There are no paths to select from.",style:M.Toast.Style.Failure})}function Pt(){let{ready:t,vaults:e}=W();if(t){if(e.length===0)return _jsx(Nt,null);if(e.length>1)return _jsx(ht,{vaults:e,target:o=>_jsx(B,{vault:o})});if(e.length==1)return _jsx(B,{vault:e[0]});yt()}else return _jsx(St.List,{isLoading:!0})}module.exports=Ft(Rt);0&&(module.exports={});
